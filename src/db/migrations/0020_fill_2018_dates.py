# Generated by aa on 2018-05-20 04:59

from django.db import migrations, models
import pandas as pd

from src.conf.djconfig import QOS_DATE_FORMAT


def fill_days(apps, schema_editor):
    # We can't import the Person model directly as it may be a newer
    # version than this migration expects. We use the historical version.
    ProductionMonth = apps.get_model('db', 'ProductionMonth')
    ProductionDay = apps.get_model('db', 'ProductionDay')

    # months 2018 creating
    months = pd.read_csv(
        'src/db/works/months_2018.csv',
        index_col=False,
        sep=';',
        names=['months', 'days', 'workdays', 'workhours'],
    )
    # import pdb
    # pdb.set_trace()

    months['months'] = pd.to_datetime(months['months'])
    for row in months.iterrows():
        el = row[1]
        ProductionMonth.objects.get_or_create(
            first_dt=el['months'].date(),
            total_days=el['days'],
            norm_work_days=el['workdays'],
            norm_work_hours=el['workhours'],
        )

    days = pd.read_csv(
        'src/db/works/days_2018.csv',
        index_col=False,
        sep=';',
        names=['dts', 'types']
    )

    days['dts'] = pd.to_datetime(days['dts'], format=QOS_DATE_FORMAT)
    for row in days.iterrows():
        el = row[1]
        ProductionDay.objects.get_or_create(
            dt=el['dts'].date(),
            type=el['types'],
        )


class Migration(migrations.Migration):

    dependencies = [
        ('db', '0019_productionday_productionmonth_workermonthstat'),
    ]

    operations = [
        migrations.RunPython(fill_days)
    ]